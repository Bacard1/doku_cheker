<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Überprüfung der Vollmacht</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 25px;
        }
        
        .input-section {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .input-group {
            display: flex;
            max-width: 500px;
            margin: 0 auto;
        }
        
        #authCodeInput {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 50px 0 0 50px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        #authCodeInput:focus {
            border-color: #3498db;
        }
        
        .btn {
            display: inline-block;
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-print {
            background: #27ae60;
            margin-left: 10px;
        }

        .btn-print:hover {
            background: #219653;
        }
        
        #checkBtn {
            border-radius: 0 50px 50px 0;
            padding: 12px 20px;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .status {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        
        .valid {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .invalid {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .info-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .info-label {
            font-weight: bold;
            width: 200px;
            color: #495057;
        }
        
        .info-value {
            flex: 1;
            color: #212529;
        }
        
        .institution-list {
            list-style-type: none;
            padding-left: 0;
        }
        
        .institution-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .institution-list li:last-child {
            border-bottom: none;
        }
        
        .institution-list li::before {
            content: "•";
            color: #3498db;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .legal-info {
            margin-top: 30px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            border: 1px solid #ffeaa7;
            text-align: center;
        }
        
        .legal-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #856404;
        }
        
        .legal-text {
            font-size: 14px;
            color: #856404;
            line-height: 1.5;
        }

        .action-buttons {
            text-align: center;
            margin-top: 20px;
        }

        /* Стилове за принтирането */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-letter, .print-letter * {
                visibility: visible;
            }
            .print-letter {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
            .no-print {
                display: none !important;
            }
        }

        .print-letter {
            display: none;
            max-width: 210mm;
            margin: 0 auto;
            padding: 25mm;
            background: white;
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.4;
            font-size: 12pt;
        }

        .letter-header {
            text-align: right;
            margin-bottom: 30px;
        }

        .letter-date {
            margin-bottom: 20px;
        }

        .letter-address {
            margin-bottom: 30px;
        }

        .letter-subject {
            font-weight: bold;
            margin: 20px 0;
            text-decoration: underline;
        }

        .letter-content {
            margin-bottom: 30px;
        }

        .letter-signature {
            margin-top: 50px;
        }

        .letter-footer {
            margin-top: 50px;
            font-size: 10pt;
            color: #666;
        }
        
        @media (max-width: 600px) {
            .input-group {
                flex-direction: column;
            }
            
            #authCodeInput {
                border-radius: 50px;
                margin-bottom: 10px;
            }
            
            #checkBtn {
                border-radius: 50px;
            }
            
            .info-row {
                flex-direction: column;
            }
            
            .info-label {
                width: 100%;
                margin-bottom: 5px;
            }

            .action-buttons {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .btn-print {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container no-print">
        <header>
            <h1>Überprüfung der Vollmacht</h1>
            <div class="subtitle">Bitte geben Sie die Nummer der Vollmacht zur Überprüfung ein</div>
        </header>
        
        <div class="content">
            <div class="input-section">
                <p>Bitte geben Sie die Nummer der Vollmacht ein:</p>
                <div class="input-group">
                    <input type="text" id="authCodeInput" placeholder="Vollmacht-Nummer eingeben">
                    <button id="checkBtn" class="btn">Überprüfen</button>
                </div>
            </div>
            
            <div id="result" class="result-section hidden">
                <div class="status" id="statusMessage"></div>
                
                <div class="info-section">
                    <div class="info-title" id="titleVollmacht">Informationen zur Vollmacht</div>
                    <div class="info-row">
                        <div class="info-label">Nummer der Vollmacht:</div>
                        <div class="info-value" id="authNumber">-</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Name des Kindes:</div>
                        <div class="info-value" id="childName">-</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Name des Bevollmächtigten:</div>
                        <div class="info-value" id="authorizedName">-</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Details zum Bevollmächtigten:</div>
                        <div class="info-value" id="authorizedDetails">-</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Als Vorbild dienen:</div>
                        <div class="info-value" id="validInstitution">-</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Ausstellungsdatum:</div>
                        <div class="info-value" id="issueDate">-</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Gültig bis:</div>
                        <div class="info-value" id="validUntil">-</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="printBtn" class="btn btn-print">Brief generieren & Drucken</button>
                </div>
            </div>
            
            <div id="loading" class="loading hidden">
                Informationen werden geladen...
            </div>
            
            <div class="legal-info">
                <div class="legal-title">Rechtliche Hinweise:</div>
                <div class="legal-text">
                    Bestätigte Dokumente mit Status "GÜLTIG" sind von Denislav Pasev und Christiana Belnikolova ausgefüllt und unterzeichnet.<br>
                    Bei ungültigen Vollmachten behalten wir uns das Recht vor, Personen, die ungültige Vollmachten verwenden, zur Verantwortung zu ziehen!
                </div>
            </div>
        </div>
    </div>

    <!-- Писмо за принтиране -->
    <div id="printLetter" class="print-letter"></div>

    <script>
        // Elemente
        const authCodeInput = document.getElementById('authCodeInput');
        const checkBtn = document.getElementById('checkBtn');
        const printBtn = document.getElementById('printBtn');
        const resultElement = document.getElementById('result');
        const statusMessage = document.getElementById('statusMessage');
        const loadingElement = document.getElementById('loading');
        const printLetterElement = document.getElementById('printLetter');
        
        // Elemente für Informationen
        const authNumberElement = document.getElementById('authNumber');
        const childNameElement = document.getElementById('childName');
        const authorizedNameElement = document.getElementById('authorizedName');
        const authorizedDetailsElement = document.getElementById('authorizedDetails');
        const validInstitutionElement = document.getElementById('validInstitution');
        const issueDateElement = document.getElementById('issueDate');
        const validUntilElement = document.getElementById('validUntil');
        const titleVollmachtElement = document.getElementById('titleVollmacht');

        // Глобални променливи за информацията
        let currentAuthInfo = null;
        let senderInfo = null;

        // Laden der Liste der gültigen Vollmachten
        let validAuthorizations = [];
        
        async function loadValidAuthorizations() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/Bacard1/doku_cheker/main/valid_authorizations.txt');
                const text = await response.text();
                
                validAuthorizations = text.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);
                
                console.log('Geladene gültige Vollmachten:', validAuthorizations);
            } catch (error) {
                console.error('Fehler beim Laden der gültigen Vollmachten:', error);
                validAuthorizations = ['AUTH-2023-001', 'AUTH-2023-002', 'AUTH-2024-010'];
            }
        }

        // Laden der Absenderinformationen
        async function loadSenderInfo() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/Bacard1/doku_cheker/main/sender_info.json');
                senderInfo = await response.json();
                console.log('Geladene Absenderinformationen:', senderInfo);
            } catch (error) {
                console.error('Fehler beim Laden der Absenderinformationen:', error);
                // Fallback Informationen
                senderInfo = {
                    senderName: "Denislav Pasev",
                    senderAddress: "Musterstraße 123, 44141 Dortmund, Deutschland",
                    senderPhone: "+49 123 456789",
                    senderEmail: "denislav.pasev@email.de"
                };
            }
        }
        
        // Laden der Informationen für eine bestimmte Vollmacht
        async function loadAuthorizationInfo(authCode) {
            try {
                const response = await fetch(`https://raw.githubusercontent.com/Bacard1/doku_cheker/main/${authCode}.json`);
                if (!response.ok) {
                    throw new Error('Datei nicht gefunden');
                }
                return await response.json();
            } catch (error) {
                console.error('Fehler beim Laden der Informationen:', error);
                return null;
            }
        }

        // Funktion zur Überprüfung der Vollmacht
        async function checkAuthorization(authCode) {
            // Loading anzeigen
            loadingElement.classList.remove('hidden');
            resultElement.classList.add('hidden');
            
            // Prüfen, ob der Code in der Liste der gültigen Vollmachten ist
            const isValid = validAuthorizations.includes(authCode);
            
            if (isValid) {
                // Informationen aus der JSON-Datei laden
                const authInfo = await loadAuthorizationInfo(authCode);
                
                // Loading ausblenden
                loadingElement.classList.add('hidden');
                resultElement.classList.remove('hidden');
                
                if (authInfo) {
                    currentAuthInfo = authInfo; // Запазваме информацията за принтиране
                    
                    statusMessage.textContent = "✅ Die Vollmacht ist GÜLTIG";
                    statusMessage.className = "status valid";
                    
                    // Informationen aus der JSON-Datei füllen
                    authNumberElement.textContent = authInfo.authNumber || authCode;
                    childNameElement.textContent = authInfo.childName || '-';
                    authorizedNameElement.textContent = authInfo.authorizedName || '-';
                    authorizedDetailsElement.textContent = authInfo.authorizedDetails || '-';
                    issueDateElement.textContent = authInfo.issueDate || '-';
                    validUntilElement.textContent = authInfo.validUntil || '-';
                    
                    // Titel der Vollmacht setzen
                    if (authInfo.titleVollmacht) {
                        titleVollmachtElement.textContent = authInfo.titleVollmacht;
                    }
                    
                    // Institutionen anzeigen (Array oder String)
                    if (Array.isArray(authInfo.validInstitution)) {
                        // Wenn es ein Array ist - zeige als Liste an
                        const institutionList = document.createElement('ul');
                        institutionList.className = 'institution-list';
                        
                        authInfo.validInstitution.forEach(institution => {
                            const li = document.createElement('li');
                            li.textContent = institution;
                            institutionList.appendChild(li);
                        });
                        
                        validInstitutionElement.innerHTML = '';
                        validInstitutionElement.appendChild(institutionList);
                    } else {
                        // Wenn es ein String ist - normal anzeigen
                        validInstitutionElement.textContent = authInfo.validInstitution || '-';
                        validInstitutionElement.innerHTML = ''; // Clear previous content
                        validInstitutionElement.textContent = authInfo.validInstitution || '-';
                    }
                } else {
                    statusMessage.textContent = "❌ Fehler beim Laden der Informationen";
                    statusMessage.className = "status invalid";
                    
                    // Informationen löschen
                    clearAuthInfo();
                }
            } else {
                // Loading ausblenden
                loadingElement.classList.add('hidden');
                resultElement.classList.remove('hidden');
                
                statusMessage.textContent = "❌ Die Vollmacht ist UNGÜLTIG";
                statusMessage.className = "status invalid";
                
                // Informationen löschen
                clearAuthInfo();
                authNumberElement.textContent = authCode;
            }
            
            // Zum Ergebnis scrollen
            resultElement.scrollIntoView({ behavior: 'smooth' });
        }

        // Funktion zum Generieren des Briefes
        function generateLetter() {
            if (!currentAuthInfo || !senderInfo) {
                alert('Keine Vollmacht-Informationen verfügbar');
                return;
            }

            const today = new Date();
            const formattedDate = today.toLocaleDateString('de-DE');

            const letterHTML = `
                <div class="letter-header">
                    <div><strong>${senderInfo.senderName}</strong></div>
                    <div>${senderInfo.senderAddress}</div>
                    <div>Tel: ${senderInfo.senderPhone}</div>
                    <div>Email: ${senderInfo.senderEmail}</div>
                </div>

                <div class="letter-date">
                    <strong>Datum:</strong> ${formattedDate}
                </div>

                <div class="letter-address">
                    <strong>An:</strong><br>
                    ${Array.isArray(currentAuthInfo.validInstitution) ? 
                      currentAuthInfo.validInstitution.join('<br>') : 
                      currentAuthInfo.validInstitution}
                </div>

                <div class="letter-subject">
                    Betreff: Bestätigung der Vollmacht - ${currentAuthInfo.authNumber}
                </div>

                <div class="letter-content">
                    <p>Sehr geehrte Damen und Herren,</p>

                    <p>hiermit bestätige ich die Gültigkeit der nachstehend beschriebenen Vollmacht:</p>

                    <p>
                        <strong>Vollmacht-Nummer:</strong> ${currentAuthInfo.authNumber}<br>
                        <strong>Name des Kindes:</strong> ${currentAuthInfo.childName}<br>
                        <strong>Bevollmächtigte Person/Institution:</strong> ${currentAuthInfo.authorizedName}<br>
                        <strong>Details zur Bevollmächtigung:</strong> ${currentAuthInfo.authorizedDetails}<br>
                        <strong>Ausstellungsdatum:</strong> ${currentAuthInfo.issueDate}<br>
                        <strong>Gültig bis:</strong> ${currentAuthInfo.validUntil}<br>
                        <strong>Art der Vollmacht:</strong> ${currentAuthInfo.titleVollmacht}
                    </p>

                    <p>Die vorgenannte Vollmacht ist zum gegenwärtigen Zeitpunkt gültig und berechtigt zur Durchführung der darin beschriebenen Handlungen.</p>

                    <p>Für Rückfragen stehe ich Ihnen gerne zur Verfügung.</p>

                    <p>Mit freundlichen Grüßen</p>
                </div>

                <div class="letter-signature">
                    <div style="margin-bottom: 40px;">_________________________</div>
                    <div><strong>${senderInfo.senderName}</strong></div>
                </div>

                <div class="letter-footer">
                    <p><strong>Rechtlicher Hinweis:</strong><br>
                    Diese Bestätigung dient lediglich der Information über den aktuellen Status der Vollmacht. 
                    Bei Verdacht auf Missbrauch behalten wir uns rechtliche Schritte vor.</p>
                </div>
            `;

            printLetterElement.innerHTML = letterHTML;
            printLetterElement.style.display = 'block';
            
            // Принтиране
            window.print();
            
            // Скриваме писмото след принтиране
            setTimeout(() => {
                printLetterElement.style.display = 'none';
            }, 500);
        }

        // Funktion zum Löschen der Informationen
        function clearAuthInfo() {
            authNumberElement.textContent = '-';
            childNameElement.textContent = '-';
            authorizedNameElement.textContent = '-';
            authorizedDetailsElement.textContent = '-';
            validInstitutionElement.innerHTML = '-';
            issueDateElement.textContent = '-';
            validUntilElement.textContent = '-';
            titleVollmachtElement.textContent = 'Informationen zur Vollmacht';
            currentAuthInfo = null;
        }

        // Initialisierung beim Laden der Seite
        window.addEventListener('load', () => {
            loadValidAuthorizations();
            loadSenderInfo();
            
            // Überprüfung beim Klicken des Buttons
            checkBtn.addEventListener('click', () => {
                const code = authCodeInput.value.trim();
                if (code) {
                    checkAuthorization(code);
                    authCodeInput.value = '';
                } else {
                    alert('Bitte geben Sie eine Vollmacht-Nummer ein');
                }
            });
            
            // Überprüfung bei Enter-Taste
            authCodeInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkBtn.click();
                }
            });

            // Генериране на писмо
            printBtn.addEventListener('click', generateLetter);
        });
    </script>
</body>
</html>